<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math Competition Pro</title>
<link rel="manifest" href="manifest.json">
<style>
body{
 margin:0;
 font-family:Arial;
 background:linear-gradient(135deg,#667eea,#764ba2);
 color:white;
}
.header{
 display:flex;
 justify-content:space-between;
 padding:15px 30px;
 font-size:20px;
 font-weight:bold;
}
.main{
 display:flex;
 height:calc(100vh - 60px);
}
.game{
 flex:3;
 overflow:auto;
 padding:20px;
}
.sidebar{
 flex:1;
 padding:20px;
}
table{border-collapse:collapse;}
td{
 background:white;
 color:black;
 padding:10px;
 border-radius:12px;
 text-align:center;
 width:120px;
}
input{width:60px;text-align:center;}
.correct{background:#a5f3a5!important;}
.wrong{background:#ff9e9e!important;}
button{padding:8px 12px;margin:5px;border-radius:8px;border:none;cursor:pointer;}
.numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
</style>
</head>
<body>

<div class="header">
<div>üéÆ Math Competition Pro</div>
<div>‚è± <span id="timer">00:00</span></div>
<div>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score">0</span></div>
</div>

<div style="padding:10px;">
<select id="mode">
<option value="1x10">1x10</option>
<option value="2x10">2x10</option>
<option value="3x20">3x20</option>
</select>

<select id="count">
<option value="3">3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</option>
<option value="4">4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</option>
<option value="5" selected>5 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</option>
</select>

<button onclick="createQuestions()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
<button onclick="checkAnswers()">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
</div>

<div class="main">
<div class="game" id="table"></div>

<div class="sidebar">
<h3>üèÜ TOP 5</h3>
<div id="ranking"></div>
<div class="numpad" id="numpad"></div>
</div>
</div>

<script>
let answers=[];
let startTime=0;
let currentInput=null;
let ranking=JSON.parse(localStorage.getItem("ranking")||"[]");

function formatTime(sec){
 let m=Math.floor(sec/60);
 let s=sec%60;
 return String(m).padStart(2,'0')+":"+String(s).padStart(2,'0');
}

function updateTimer(){
 if(startTime){
  let sec=Math.floor((Date.now()-startTime)/1000);
  document.getElementById("timer").innerText=formatTime(sec);
 }
 requestAnimationFrame(updateTimer);
}
updateTimer();

function generateQuestion(count){
 while(true){
  let nums=[...Array(count)].map(()=>Math.floor(Math.random()*10));
  let result=nums[0];
  let ops=[];
  let valid=true;
  for(let i=1;i<count;i++){
   let op=Math.random()<0.5?'+':'-';
   if(op==='-' && result-nums[i]<0){ valid=false; break;}
   result=op==='+'?result+nums[i]:result-nums[i];
   ops.push(op);
  }
  if(valid && result>0) return {nums,ops,result};
 }
}

function createQuestions(){
 answers=[];
 let mode=document.getElementById("mode").value;
 let count=parseInt(document.getElementById("count").value);
 let rows=1,cols=10;
 if(mode==="2x10"){rows=2;cols=10;}
 if(mode==="3x20"){rows=3;cols=20;}
 let html="<table>";
 for(let r=0;r<rows;r++){
  html+="<tr>";
  for(let c=0;c<cols;c++){
   let q=generateQuestion(count);
   answers.push(q.result);
   html+="<td>";
   html+=q.nums[0]+"<br>";
   for(let i=0;i<q.ops.length;i++){
    html+=q.ops[i]+" "+q.nums[i+1]+"<br>";
   }
   html+="<hr><input type='number' onclick='currentInput=this'>";
   html+="</td>";
  }
  html+="</tr>";
 }
 html+="</table>";
 document.getElementById("table").innerHTML=html;
 startTime=Date.now();
}

function checkAnswers(){
 let inputs=document.querySelectorAll("input");
 let score=0;
 inputs.forEach((inp,i)=>{
  if(parseInt(inp.value)===answers[i]){
   score++;
   inp.className="correct";
  }else{
   inp.className="wrong";
  }
 });
 let sec=Math.floor((Date.now()-startTime)/1000);
 document.getElementById("score").innerText=score+"/"+answers.length;
 ranking.push({score,time:sec});
 ranking.sort((a,b)=>b.score-a.score || a.time-b.time);
 ranking=ranking.slice(0,5);
 localStorage.setItem("ranking",JSON.stringify(ranking));
 showRanking();
}

function showRanking(){
 let html="";
 ranking.forEach((r,i)=>{
  let medal=i===0?"ü•á":i===1?"ü•à":i===2?"ü•â":"üéñ";
  html+=medal+" "+r.score+" | "+formatTime(r.time)+"<br>";
 });
 document.getElementById("ranking").innerHTML=html;
}
showRanking();

let nums=['7','8','9','4','5','6','1','2','3','0','‚å´','C'];
nums.forEach(n=>{
 let btn=document.createElement("button");
 btn.innerText=n;
 btn.onclick=()=>{
  if(!currentInput) return;
  if(n==="‚å´") currentInput.value=currentInput.value.slice(0,-1);
  else if(n==="C") currentInput.value="";
  else currentInput.value+=n;
 };
 document.getElementById("numpad").appendChild(btn);
});

if('serviceWorker' in navigator){
 navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>
